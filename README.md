copy example.env to dist
# Generate Employee Absence Calendar data workflow

## Introduction
Workflow is triggered by SQS messages. During the execution it retrieve employee absence data from [api.nmbrs.nl](https://api.nmbrs.nl) and save as JSON files with required structure.

## Implementation details
Main used dependencies:
- [sqs-consumer](sqs-consumer)
- [node-soap](https://github.com/vpulim/node-soap)
- [typescript](https://www.typescriptlang.org/)
- [Mocha](https://mochajs.org/)

### Runing the API
1. Install dependencies and build using `npm install`.
2. Copy `example.env` as `.env` and update it according to queue details which will be used to trigger the workflow.
3. Run workflow using `npm start`.
3. Check logs and ./output directory.
4. To re-build the workflow use `npm run build`.

## Testing
### Using Local Stack
1. Copy `example.env` as `.env`
2. [Install Docker Compose](https://docs.docker.com/compose/install/), run Docker and update `.env/SQS_URL` with <Docker default machine IP>:4576
3. Run Local Stack and create queue by command `npm run startLocalStack`
4. Uncomment below two lines in `index.ts`:
```
// const messageCommand = "{'source_app' => 'nmbrs', 'user' => 'michiel.crommelinck@officient.io', 'pass' => '2ed523df992646bf9bcfef66f75ef758', 'group' => 1234, 'controller' => 'importDaysoff',}";
// lib.sendMessage(sqs, queueUrl, messageCommand);
```
5. Build by command `npm build`
6. Run workflow by command `npm run`
7. Check log and ./output folder.

### Unit tests
1. Run mocha by `npm run test`

## Notes
* vscode directory was committed to repository let to debug normal and unit tests execution in VSCode
* Unit test contain assertions strictly testing the correctnes of data generated by the workflow.
* Assertion for `IEmployeData.historical_days_off[item].date` compare parsed Date to handle timezones difference.
* Unit tests checking error handling was skipped due time limits.